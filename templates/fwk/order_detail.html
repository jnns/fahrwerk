{% extends 'base.html' %}

{% block head %}
<script src='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.js'></script>
<link href='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.css' rel='stylesheet' />
<style>
  #map { width:100%; height: 200px }
</style>
{% endblock head %}

{% block body %}

    <div class="order-detail">
        <h1 class="order-detail__header">Sendungsverfolgung</h1>

        Hier siehst du den aktuellen Status deiner Sendung.

        Du kannst diese Seite jederzeit unter folgender Adresse aufrufen:

        <div class="order-detail__address">
            <span class="order-detail__address--domain">http://bestellen.fahrwerk-berlin.de/</span><span class="order-detail__address--hash">{{ order.get_hash_id }}</span>
        </div>

        <h2 class="order-detail__summary-header">Zusammenfassung</h2>
        <div class="order-detail__summary">
            <div class="order-detail__from_summary">

                <h3>Abholadresse</h3>

                {% if order.from_company %}{{ order.from_company }}<br>{% endif %}

                <strong>{{ order.from_person }}</strong><br>

                {{ order.from_street }}<br>
                {{ order.from_zipcode }} Berlin<br>

                <div class="order-summary__field">
                    <label>Telefon</label>
                    {{ order.from_phone_no }}<br>
                </div>

                <div class="order-summary__field">
                    <label>Abholung zwischen</label>
                    {{ order.get_timeframe_pickup_display }} Uhr
                </div>

                {% if order.from_comment %}
                <div class="order-summary__field">
                    <label>Bemerkung</label>
                    {{ order.from_comment }}</p>
                </div>
                {% endif %}

            </div>

            <div class="order-detail__to_summary">

                <h3>Zustelladresse</h3>

                {% if order.to_company %}{{ order.to_company }}<br>{% endif %}

                <strong>{{ order.to_person }}</strong><br>

                {{ order.to_street }}<br>
                {{ order.to_zipcode }} Berlin<br>

                <div class="order-summary__field">
                    <label>Telefon</label>
                    {{ order.to_phone_no }}<br>
                </div>

                <div class="order-summary__field">
                    <label>Abholung zwischen</label>
                    {{ order.get_timeframe_pickup_display }} Uhr
                </div>

                {% if order.to_comment %}
                <div class="order-summary__field">
                    <label>Bemerkung</label>
                    {{ order.to_comment }}</p>
                </div>
                {% endif %}

            </div>


        </div>

        <div class="order-detail__details">

            <div class="order-summary__field">
                <label>Packstücke</label>
                {% with order.packages_s as s %}
                    {% if s %}
                        {{ s }} klein{{ s|pluralize:"es,e"}} Packstück{{ p|pluralize:"e" }}<br>
                    {% endif %}
                {% endwith %}

                {% with order.packages_m as p %}
                    {% if p %}
                        {{ p }} mittelgroß{{ p|pluralize:"es,e"}} Packstück{{ p|pluralize:"e" }}<br>
                    {% endif %}
                {% endwith %}

                {% with order.packages_l as p %}
                    {% if p %}
                        {{ p }} groß{{ p|pluralize:"es,e"}} Packtück{{ p|pluralize:"e" }}<br>
                    {% endif %}
                {% endwith %}
            </div>

            {% if order.package_detail %}
            <div class="order-summary__field">
                <label>Was wird transportiert?</label>
                {{ order.package_detail }}
            </div>
            {% endif %}

            <div class="order-summary__field">
                <label>Bezahlung</label>
                {% if order.customer == 'PICKUP' %}
                    bei Abholung<br>({{ order.from_person}})
                {% else %}
                    bei Abgabe<br>({{ order.to_person}})
                {% endif %}
            </div>

        </div>

        <h2 class="order-detail__rate-header">Tarif & Preis</h2>

        <div class="order-detail__calculation">
            <span class="order-detail__distance">{{ order.distance }} km</span> mit dem
            <span class="order-detail__rate">{{ order.get_rate_display }}</span>
            für
            <span class="order-detail__price">{{ order.price }} €</span>
        </div>


        <h2 class="order-detail__progress-header">Status</h2>
        {% with order.status as s %}
        <ol class="order-detail__progress">

            <li class="order-detail__status
                {% if s == 'NEW' %}order-detail__status--current{% endif %}">
                Auftrag eingegangen
                <span class="status__timestamp">{{ order.ordered|date:"d.m.Y H:m" }} Uhr</span>
            </li>
            <li class="order-detail__status
                {% if s == 'CONFIRMED' %}order-detail__status--current{% endif %}">
                Auftrag bestätigt
            </li>
            <li class="order-detail__status
                {% if s == 'PICKED_UP' %}order-detail__status--current{% endif %}">
                Sendung abgeholt
            </li>
            <li class="order-detail__status
                {% if s == 'DELIVERED' %}order-detail__status--current{% endif %}">
                Sendung ausgeliefert
                <span class="status__timestamp">{% if order.delivered %}{{ order.delivered|date:"d.m.Y H:m" }} Uhr{% endif %}</span>
            </li>
        </ol>
        {% endwith %}

        <div id="map" class="order-detail__map">
        </div>

        <script>
        var geojson = {{ order.directions_json|safe }};

        L.mapbox.accessToken = 'pk.eyJ1Ijoiam5ucyIsImEiOiJjaWdkanI2cW0wN3pudmprcjd5emNkZGliIn0.XU8kSbBiCjLZ6E7PCI3_SQ';
        L.mapbox.map('map', 'mapbox.streets').setView([52.507,13.396], 13).
            featureLayer.setGeoJSON(geojson);
        </script>

        <div class="order-detail__attribution">
            Kartendaten: © <a href='https://www.mapbox.com/about/maps/'>Mapbox</a> © <a href='http://www.openstreetmap.org/copyright'>OpenStreetMap</a>
        </div>

    </div>



{% endblock %}